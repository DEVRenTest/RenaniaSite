<modification>
	<id>sort_fix</id>
	<version>1.0.0</version>
	<vqmver>2.1.5</vqmver>
	<author>Szasz Bela</author>
	<file name="catalog/model/module/filterpro.php">
		<operation>
			<search position="replace"><![CDATA[
              $sql = "SELECT product_id FROM(";
            ]]></search>
			<add>
            <![CDATA[
              $sql = "SELECT product_id,model,flag,date_added FROM(";
            ]]>
            </add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
              $sql .= "SELECT DISTINCT p.product_id, pd.name, p.model, p.quantity, p.price, p.sort_order, p.date_added ";
            ]]></search>
			<add>
            <![CDATA[
              $sql .= "SELECT DISTINCT p.product_id, pd.name, p.model, p.flag,p.quantity, p.price, p.sort_order, p.date_added ";
            ]]>
            </add>
		</operation>
        
		<operation>
			<search position="replace"><![CDATA[
              $sql .= " ORDER BY ".$data['sort'];
            ]]></search>
			<add>
            <![CDATA[
                //SORT_FIX: (Bela)
                if ( $data['sort'] == "sort_order" ) {
                    $sql .= " ORDER BY flag=1 DESC,date_added DESC,".$data['sort'];
                } else {
                    $sql .= " ORDER BY ".$data['sort'];
                }
            ]]>
            </add>
		</operation>
    </file>	
</modification>

